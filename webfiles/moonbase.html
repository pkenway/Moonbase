<html>
	<head>
		<script type="text/javascript" src="jquery-1.7.1.min.js"></script>
		
		<script type="text/javascript" src="jquery-ui-1.8.17.custom.min.js"></script>
		
		<script type="text/javascript" src="moonbase.gameboard.js"></script>
		<script type="text/javascript" src="moonbase.playstate.js"></script>
		<script type="text/javascript" src="moonbase.mapgen.js"></script>
		<script type="text/javascript" src="moonbase.params.js"></script>
		<link rel="stylesheet" href="moonbase.css"/>
		</head>
	<body>
		<div id="divState">
			Money:<span class="money"></span>
			Score: <span class="score"></span>
			Energy: <span class="energy"></span>
			Turns Left: <span class="turn"></span>
		</div>
		
		<table id="buildings" style="float:right">
			<tr>
				<td class="building"><img src="images/ccenter1.png" title="ccenter"/></td>
				<td  class="building"><img src="images/solarpanel1.png" title="solarpanel" /></td>
				<td  class="building"><img src="images/mine1.png" title="mine"/></td>
			</tr>
			<tr>
				<td  class="building"><img src="images/biodome1.png" title="biodome"/></td>
				<td  class="building"><img src="images/battery1.png" title="battery"/></td>
				<td  class="building"><img src="images/powerlines1.png" title="powerlines"/></td>
			</tr>
		</table>
		<table id="tblGameGrid">
		</table>
		
		<a href="javascript:void(0)" id="btnNextTurn">Next Turn</a>
		<a href="javascript:void(0)" id="btnFireLaser">Fire Laser</a>
		<div id="divDebug"></div>
		
		<script type="text/javascript">
			
			function statusMsg(msg) {
				$("#divDebug").html(msg);
			}
			
			var isLaserFiring = false;
			
			$(document).ready(function() {
				//load a grid of spaces
				$("#tblGameGrid").gameboard({
					width:gameparams.map.width,
					height:gameparams.map.height,
					action:function(type) {
						var state = $("#divState").playstate("getState");
						var harvested =  $("#tblGameGrid").gameboard("harvest"); 
						state.money += harvested.money;
						state.score += harvested.score;
						state.energy += harvested.energy;
						$("#divState").playstate("setState",state);
						$("#divState").playstate("nextTurn");
					},
					tryBuy:function(cost) {
						var state = $("#divState").playstate("getState");
						
						if(cost > state.money)  return false;
						state.money -= cost;
						$("#divState").playstate("setState",state);
						return true;
					},
					tryFireLaser:function() {
						var state = $("#divState").playstate("getState");
						
						if(state.energy < gameparams.laserenergycost) {
							return false;
						}
						state.energy -= gameparams.laserenergycost;
						return true;
					},
					statusMsg:statusMsg,
					gameparams:gameparams
				});
				
				//load board data
				$("#tblGameGrid").gameboard("loadGridData",generateMap(gameparams));
				
				$("#btnNextTurn").click(function() {
					$("#divState").playstate("nextturn");
				});
				
				$("#btnFireLaser").click(function() {
					statusMsg("Click a tile to fire the laser");
					$("#tblGameGrid").gameboard("setInterfaceMode","laser");
				});
				
				$("#divState").playstate({
					state:{money:100,score:0,turnsremaining:gameparams.turnCount},
					gameparams:gameparams,
					onGameEnd:function(score) {
						$("#tblGameGrid").gameboard("exploreAll");
						alert("Game over.  Final score: " + score);
					}
				});
				
				$("#buildings .building img").draggable({helper:"clone"});
			});
		</script>
	</body>
</html>
	